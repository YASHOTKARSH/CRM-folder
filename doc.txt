# ğŸ“˜ AGENCY CRM â€“ DEVELOPMENT BLUEPRINT

**Version:** 1.0
**Backend:** Spring Boot
**Frontend:** React (Vite)
**Database:** MySQL
**Authentication:** JWT + Role-Based Access Control

---

# 1ï¸ SYSTEM OVERVIEW

## 1.1 Purpose

Agency CRM is a web-based system designed to manage:

* Leads
* Employee hierarchy
* Client conversion
* Plan management
* Performance dashboards

The system supports structured role-based access and hierarchical tracking.

---

# 2ï¸ SYSTEM ARCHITECTURE

React (Frontend)
â¬‡ REST API
Spring Boot (Backend)
â¬‡
MySQL Database

---

# 3ï¸ DATABASE DESIGN (MySQL)

## 3.1 Tables Overview

* users
* leads
* clients
* plans

---

## 3.2 USERS TABLE

| Field        | Type                                           |
| ------------ | ---------------------------------------------- |
| id           | BIGINT (PK, AUTO_INCREMENT)                    |
| name         | VARCHAR(100)                                   |
| email        | VARCHAR(100), UNIQUE                           |
| password     | VARCHAR(255)                                   |
| role         | ENUM('ADMIN','MANAGER','TEAM_LEAD','EMPLOYEE') |
| manager_id   | BIGINT (FK, nullable)                          |
| team_lead_id | BIGINT (FK, nullable)                          |
| created_at   | TIMESTAMP                                      |

Hierarchy Logic:

* Manager reports to Admin
* Team Lead reports to Manager
* Employee reports to Team Lead

---

## 3.3 LEADS TABLE

| Field                 | Type                                                    |
| --------------------- | ------------------------------------------------------- |
| id                    | BIGINT (PK, AUTO_INCREMENT)                             |
| name                  | VARCHAR(100)                                            |
| email                 | VARCHAR(100)                                            |
| phone                 | VARCHAR(20)                                             |
| source                | VARCHAR(100)                                            |
| interested_percentage | INT                                                     |
| status                | ENUM('NEW','CONTACTED','INTERESTED','CONVERTED','LOST') |
| assigned_to           | BIGINT (FK â†’ users.id)                                  |
| created_at            | TIMESTAMP                                               |
| updated_at            | TIMESTAMP                                               |

---

## 3.4 CLIENTS TABLE

| Field             | Type                        |
| ----------------- | --------------------------- |
| id                | BIGINT (PK, AUTO_INCREMENT) |
| name              | VARCHAR(100)                |
| email             | VARCHAR(100)                |
| phone             | VARCHAR(20)                 |
| plan_id           | BIGINT (FK â†’ plans.id)      |
| assigned_employee | BIGINT (FK â†’ users.id)      |
| conversion_date   | TIMESTAMP                   |

---

## 3.5 PLANS TABLE

| Field       | Type                        |
| ----------- | --------------------------- |
| id          | BIGINT (PK, AUTO_INCREMENT) |
| name        | VARCHAR(100)                |
| description | TEXT                        |
| price       | DECIMAL(10,2)               |
| created_at  | TIMESTAMP                   |

---

# 4ï¸ BACKEND PROJECT STRUCTURE

com.agencycrm
â”‚
â”œâ”€â”€ config
â”‚   â””â”€â”€ SecurityConfig
â”‚
â”œâ”€â”€ controller
â”‚   â”œâ”€â”€ AuthController
â”‚   â”œâ”€â”€ LeadController
â”‚   â”œâ”€â”€ ClientController
â”‚   â”œâ”€â”€ PlanController
â”‚   â””â”€â”€ DashboardController
â”‚
â”œâ”€â”€ service
â”‚   â”œâ”€â”€ AuthService
â”‚   â”œâ”€â”€ LeadService
â”‚   â”œâ”€â”€ ClientService
â”‚   â”œâ”€â”€ PlanService
â”‚   â””â”€â”€ DashboardService
â”‚
â”œâ”€â”€ repository
â”‚   â”œâ”€â”€ UserRepository
â”‚   â”œâ”€â”€ LeadRepository
â”‚   â”œâ”€â”€ ClientRepository
â”‚   â””â”€â”€ PlanRepository
â”‚
â”œâ”€â”€ entity
â”‚   â”œâ”€â”€ User
â”‚   â”œâ”€â”€ Lead
â”‚   â”œâ”€â”€ Client
â”‚   â””â”€â”€ Plan
â”‚
â”œâ”€â”€ dto
â”‚
â”œâ”€â”€ security
â”‚   â”œâ”€â”€ JwtFilter
â”‚   â”œâ”€â”€ JwtUtil
â”‚   â””â”€â”€ CustomUserDetailsService
â”‚
â””â”€â”€ exception

---

# 5ï¸ AUTHENTICATION FLOW

1. User sends email + password
2. Backend validates credentials
3. JWT token generated
4. Token returned to frontend
5. Frontend sends token in header

Header Format:

Authorization: Bearer <token>

Spring Security:

* Stateless session
* JWT filter before UsernamePasswordAuthenticationFilter

---

# 6ï¸ ROLE-BASED ACCESS FLOW

Access Control Rules:

ADMIN

* Access all endpoints

MANAGER

* Access users under them
* Access leads and clients under their team

TEAM_LEAD

* Access employees under them
* Access assigned team leads

EMPLOYEE

* Access only assigned leads and clients

Filtering logic implemented in Service layer.

---

# 7ï¸ CORE BUSINESS FLOW

---

# 7.1 Lead Creation Flow

1. Admin / Manager / Team Lead creates lead
2. Lead assigned to employee
3. Lead stored in database

---

# 7.2 Lead Update Flow

Employee updates:

* Interested percentage
* Status

Status progression:
NEW â†’ CONTACTED â†’ INTERESTED â†’ CONVERTED / LOST

---

# 7.3 Lead Conversion Flow

When status = CONVERTED:

1. Create Client record
2. Copy basic details
3. Assign plan
4. Store conversion date

---

# 7.4 Plan Creation Flow

Admin:

1. Creates plan
2. Plan stored in database
3. Plan selectable during client conversion

---

# 8ï¸ DASHBOARD DATA FLOW

Dashboard data is calculated using aggregation queries.

---

## 8.1 Employee Dashboard

* Total Leads Assigned
* Interested Leads
* Converted Leads
* Conversion Rate

---

## 8.2 Team Lead Dashboard

* Total Team Leads
* Team Conversions
* Team Conversion Rate
* Employee-wise stats

---

## 8.3 Manager Dashboard

* Total Leads Under Manager
* Total Clients
* Team Performance Breakdown

---

## 8.4 Admin Dashboard

* Total Leads
* Total Clients
* Total Users
* Plan Distribution
* Overall Conversion Rate

---

# 9ï¸ API STRUCTURE

---

## Authentication

POST /api/auth/login
POST /api/auth/register

---

## Leads

POST /api/leads
GET /api/leads
GET /api/leads/{id}
PUT /api/leads/{id}
DELETE /api/leads/{id}
PUT /api/leads/{id}/convert

---

## Clients

GET /api/clients
GET /api/clients/{id}
PUT /api/clients/{id}
DELETE /api/clients/{id}

---

## Plans

POST /api/plans
GET /api/plans
PUT /api/plans/{id}
DELETE /api/plans/{id}

---

## Dashboard

GET /api/dashboard/admin
GET /api/dashboard/manager
GET /api/dashboard/teamlead
GET /api/dashboard/employee

---

# 10 DEVELOPMENT EXECUTION ORDER

1. Create Spring Boot project
2. Configure MySQL connection
3. Create Entities
4. Create Repositories
5. Implement JWT authentication
6. Implement role-based security
7. Build Lead module
8. Implement conversion logic
9. Build Client module
10. Build Plan module
11. Implement Dashboard aggregation queries
12. Connect React frontend

---